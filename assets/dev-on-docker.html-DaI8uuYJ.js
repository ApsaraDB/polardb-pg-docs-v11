import{_ as c,r as d,o as p,c as i,a,b as e,d as n,w as l,e as o}from"./app-4enb6FVN.js";const u={},h=o('<h1 id="基于-docker-容器开发" tabindex="-1"><a class="header-anchor" href="#基于-docker-容器开发"><span>基于 Docker 容器开发</span></a></h1><div class="custom-container danger"><p class="custom-container-title">警告</p><p>为简化使用，容器内的 <code>postgres</code> 用户没有设置密码，仅供体验。如果在生产环境等高安全性需求场合，请务必修改健壮的密码！</p></div><h2 id="在开发机器上下载源代码" tabindex="-1"><a class="header-anchor" href="#在开发机器上下载源代码"><span>在开发机器上下载源代码</span></a></h2>',3),b={href:"https://github.com/ApsaraDB/PolarDB-for-PostgreSQL",target:"_blank",rel:"noopener noreferrer"},_=a("code",null,"POLARDB_11_STABLE",-1),g={href:"https://gitee.com/mirrors/PolarDB-for-PostgreSQL",target:"_blank",rel:"noopener noreferrer"},k=a("div",{class:"language-bash","data-ext":"sh","data-title":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"git"),e(" clone "),a("span",{class:"token parameter variable"},"-b"),e(` POLARDB_11_STABLE https://github.com/ApsaraDB/PolarDB-for-PostgreSQL.git
`)])])],-1),v=a("div",{class:"language-bash","data-ext":"sh","data-title":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"git"),e(" clone "),a("span",{class:"token parameter variable"},"-b"),e(` POLARDB_11_STABLE https://gitee.com/mirrors/PolarDB-for-PostgreSQL
`)])])],-1),m=o(`<p>代码克隆完毕后，进入源码目录：</p><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> PolarDB-for-PostgreSQL/
</code></pre></div><h2 id="拉取开发镜像" tabindex="-1"><a class="header-anchor" href="#拉取开发镜像"><span>拉取开发镜像</span></a></h2>`,3),f={href:"https://hub.docker.com/r/polardb/polardb_pg_devel/tags",target:"_blank",rel:"noopener noreferrer"},x=a("div",{class:"language-bash","data-ext":"sh","data-title":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"docker"),e(` pull polardb/polardb_pg_devel:ubuntu24.04
`)])])],-1),P=a("div",{class:"language-bash","data-ext":"sh","data-title":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"docker"),e(` pull registry.cn-hangzhou.aliyuncs.com/polardb_pg/polardb_pg_devel:ubuntu24.04
`)])])],-1),D=a("h2",{id:"创建并运行容器",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#创建并运行容器"},[a("span",null,"创建并运行容器")])],-1),B=a("p",null,"此时我们已经在开发机器的源码目录中。从开发镜像上创建一个容器，将当前目录作为一个 volume 挂载到容器中，这样可以：",-1),A=a("ul",null,[a("li",null,"在容器内的环境中编译源码"),a("li",null,"在容器外（开发机器上）使用编辑器来查看或修改代码")],-1),w=a("div",{class:"language-bash","data-ext":"sh","data-title":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"docker"),e(" run "),a("span",{class:"token parameter variable"},"-it"),e(),a("span",{class:"token punctuation"},"\\"),e(`
    `),a("span",{class:"token parameter variable"},"-v"),e(),a("span",{class:"token environment constant"},"$PWD"),e(":/home/postgres/polardb_pg "),a("span",{class:"token punctuation"},"\\"),e(`
    --shm-size`),a("span",{class:"token operator"},"="),e("512m --cap-add"),a("span",{class:"token operator"},"="),e("SYS_PTRACE "),a("span",{class:"token parameter variable"},"--privileged"),a("span",{class:"token operator"},"="),e("true "),a("span",{class:"token punctuation"},"\\"),e(`
    `),a("span",{class:"token parameter variable"},"--name"),e(" polardb_pg_devel "),a("span",{class:"token punctuation"},"\\"),e(`
    polardb/polardb_pg_devel:ubuntu24.04 `),a("span",{class:"token punctuation"},"\\"),e(`
    `),a("span",{class:"token function"},"bash"),e(`
`)])])],-1),N=a("div",{class:"language-bash","data-ext":"sh","data-title":"sh"},[a("pre",{class:"language-bash"},[a("code",null,[a("span",{class:"token function"},"docker"),e(" run "),a("span",{class:"token parameter variable"},"-it"),e(),a("span",{class:"token punctuation"},"\\"),e(`
    `),a("span",{class:"token parameter variable"},"-v"),e(),a("span",{class:"token environment constant"},"$PWD"),e(":/home/postgres/polardb_pg "),a("span",{class:"token punctuation"},"\\"),e(`
    --shm-size`),a("span",{class:"token operator"},"="),e("512m --cap-add"),a("span",{class:"token operator"},"="),e("SYS_PTRACE "),a("span",{class:"token parameter variable"},"--privileged"),a("span",{class:"token operator"},"="),e("true "),a("span",{class:"token punctuation"},"\\"),e(`
    `),a("span",{class:"token parameter variable"},"--name"),e(" polardb_pg_devel "),a("span",{class:"token punctuation"},"\\"),e(`
    registry.cn-hangzhou.aliyuncs.com/polardb_pg/polardb_pg_devel:ubuntu24.04 `),a("span",{class:"token punctuation"},"\\"),e(`
    `),a("span",{class:"token function"},"bash"),e(`
`)])])],-1),O=o(`<p>进入容器后，为容器内用户获取源码目录的权限，然后编译部署 PolarDB-PG 实例。</p><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 获取权限并编译部署</span>
<span class="token builtin class-name">cd</span> polardb_pg
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> a+wr ./
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> postgres:postgres ./
./polardb_build.sh

<span class="token comment"># 验证</span>
psql <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-c</span> <span class="token string">&#39;select version();&#39;</span>
            version
--------------------------------
 PostgreSQL <span class="token number">11.9</span> <span class="token punctuation">(</span>POLARDB <span class="token number">11.9</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span> row<span class="token punctuation">)</span>
</code></pre></div><h2 id="编译测试选项说明" tabindex="-1"><a class="header-anchor" href="#编译测试选项说明"><span>编译测试选项说明</span></a></h2><p>以下表格列出了编译、初始化或测试 PolarDB-PG 集群所可能使用到的选项及说明。更多选项及其说明详见源码目录下的 <code>polardb_build.sh</code> 脚本。</p>`,4),S=a("thead",null,[a("tr",null,[a("th",null,"选项"),a("th",null,"描述"),a("th",null,"默认值")])],-1),L=a("tr",null,[a("td",null,[a("code",null,"--withrep")]),a("td",null,"是否初始化只读节点"),a("td",null,[a("code",null,"NO")])],-1),G=a("tr",null,[a("td",null,[a("code",null,"--repnum")]),a("td",null,"只读节点数量"),a("td",null,[a("code",null,"1")])],-1),T=a("tr",null,[a("td",null,[a("code",null,"--withstandby")]),a("td",null,"是否初始化热备份节点"),a("td",null,[a("code",null,"NO")])],-1),C=a("tr",null,[a("td",null,[a("code",null,"--initpx")]),a("td",null,"是否初始化为 HTAP 集群（1 个读写节点，2 个只读节点）"),a("td",null,[a("code",null,"NO")])],-1),R=a("tr",null,[a("td",null,[a("code",null,"--with-pfsd")]),a("td",null,"是否编译 PolarDB File System（PFS）相关功能"),a("td",null,[a("code",null,"NO")])],-1),H=a("td",null,[a("code",null,"--with-tde")],-1),y={href:"https://zhuanlan.zhihu.com/p/84829027",target:"_blank",rel:"noopener noreferrer"},z=a("td",null,[a("code",null,"NO")],-1),E=a("tr",null,[a("td",null,[a("code",null,"--with-dma")]),a("td",null,"是否初始化为 DMA（Data Max Availability）高可用三节点集群"),a("td",null,[a("code",null,"NO")])],-1),Q=a("tr",null,[a("td",null,[a("code",null,"-r"),e("/ "),a("code",null,"-t"),e(" / "),a("br"),a("code",null,"--regress")]),a("td",null,"在编译安装完毕后运行内核回归测试"),a("td",null,[a("code",null,"NO")])],-1),I=a("tr",null,[a("td",null,[a("code",null,"-r-px")]),a("td",null,"运行 HTAP 实例的回归测试"),a("td",null,[a("code",null,"NO")])],-1),V=a("tr",null,[a("td",null,[a("code",null,"-e"),e(" /"),a("br"),a("code",null,"--extension")]),a("td",null,"运行扩展插件测试"),a("td",null,[a("code",null,"NO")])],-1),M=a("tr",null,[a("td",null,[a("code",null,"-r-external")]),a("td",null,[e("测试 "),a("code",null,"external/"),e(" 下的扩展插件")]),a("td",null,[a("code",null,"NO")])],-1),F=a("tr",null,[a("td",null,[a("code",null,"-r-contrib")]),a("td",null,[e("测试 "),a("code",null,"contrib/"),e(" 下的扩展插件")]),a("td",null,[a("code",null,"NO")])],-1),W=a("tr",null,[a("td",null,[a("code",null,"-r-pl")]),a("td",null,[e("测试 "),a("code",null,"src/pl/"),e(" 下的扩展插件")]),a("td",null,[a("code",null,"NO")])],-1),Y=o(`<p>如无定制的需求，则可以按照下面给出的选项编译部署不同形态的 PolarDB-PG 集群并进行测试。</p><h2 id="polardb-pg-各形态编译部署" tabindex="-1"><a class="header-anchor" href="#polardb-pg-各形态编译部署"><span>PolarDB-PG 各形态编译部署</span></a></h2><h3 id="本地单节点实例" tabindex="-1"><a class="header-anchor" href="#本地单节点实例"><span>本地单节点实例</span></a></h3><ul><li>1 个读写节点（运行于 <code>5432</code> 端口）</li></ul><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./polardb_build.sh
</code></pre></div><h3 id="本地多节点实例" tabindex="-1"><a class="header-anchor" href="#本地多节点实例"><span>本地多节点实例</span></a></h3><ul><li>1 个读写节点（运行于 <code>5432</code> 端口）</li><li>1 个只读节点（运行于 <code>5433</code> 端口）</li></ul><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./polardb_build.sh <span class="token parameter variable">--withrep</span> <span class="token parameter variable">--repnum</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><h3 id="本地多节点带备库实例" tabindex="-1"><a class="header-anchor" href="#本地多节点带备库实例"><span>本地多节点带备库实例</span></a></h3><ul><li>1 个读写节点（运行于 <code>5432</code> 端口）</li><li>1 个只读节点（运行于 <code>5433</code> 端口）</li><li>1 个备库节点（运行于 <code>5434</code> 端口）</li></ul><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./polardb_build.sh <span class="token parameter variable">--withrep</span> <span class="token parameter variable">--repnum</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--withstandby</span>
</code></pre></div><h3 id="本地多节点-htap-实例" tabindex="-1"><a class="header-anchor" href="#本地多节点-htap-实例"><span>本地多节点 HTAP 实例</span></a></h3><ul><li>1 个读写节点（运行于 <code>5432</code> 端口）</li><li>2 个只读节点（运行于 <code>5433</code> / <code>5434</code> 端口）</li></ul><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./polardb_build.sh <span class="token parameter variable">--initpx</span>
</code></pre></div><h2 id="实例回归测试" tabindex="-1"><a class="header-anchor" href="#实例回归测试"><span>实例回归测试</span></a></h2><p>普通实例回归测试：</p><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./polardb_build.sh <span class="token parameter variable">--withrep</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-e</span> -r-external -r-contrib -r-pl --with-tde
</code></pre></div><p>HTAP 实例回归测试：</p><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./polardb_build.sh -r-px <span class="token parameter variable">-e</span> -r-external -r-contrib -r-pl --with-tde
</code></pre></div><p>DMA 实例回归测试：</p><div class="language-bash" data-ext="sh" data-title="sh"><pre class="language-bash"><code>./polardb_build.sh <span class="token parameter variable">-r</span> <span class="token parameter variable">-e</span> -r-external -r-contrib -r-pl --with-tde --with-dma
</code></pre></div>`,21);function $(q,J){const t=d("ExternalLinkIcon"),s=d("CodeGroupItem"),r=d("CodeGroup");return p(),i("div",null,[h,a("p",null,[e("从 "),a("a",b,[e("GitHub"),n(t)]),e(" 上下载 PolarDB for PostgreSQL 的源代码，稳定分支为 "),_,e("。如果因网络原因不能稳定访问 GitHub，则可以访问 "),a("a",g,[e("Gitee"),n(t)]),e("。")]),n(r,null,{default:l(()=>[n(s,{title:"GitHub"},{default:l(()=>[k]),_:1}),n(s,{title:"Gitee"},{default:l(()=>[v]),_:1})]),_:1}),m,a("p",null,[e("拉取 PolarDB-PG 的 "),a("a",f,[e("开发镜像"),n(t)]),e("。")]),n(r,null,{default:l(()=>[n(s,{title:"DockerHub"},{default:l(()=>[x]),_:1}),n(s,{title:"阿里云 ACR"},{default:l(()=>[P]),_:1})]),_:1}),D,B,A,n(r,null,{default:l(()=>[n(s,{title:"DockerHub"},{default:l(()=>[w]),_:1}),n(s,{title:"阿里云 ACR"},{default:l(()=>[N]),_:1})]),_:1}),O,a("table",null,[S,a("tbody",null,[L,G,T,C,R,a("tr",null,[H,a("td",null,[e("是否初始化 "),a("a",y,[e("透明数据加密（TDE）"),n(t)]),e(" 功能")]),z]),E,Q,I,V,M,F,W])]),Y])}const K=c(u,[["render",$],["__file","dev-on-docker.html.vue"]]),U=JSON.parse('{"path":"/zh/development/dev-on-docker.html","title":"基于 Docker 容器开发","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"在开发机器上下载源代码","slug":"在开发机器上下载源代码","link":"#在开发机器上下载源代码","children":[]},{"level":2,"title":"拉取开发镜像","slug":"拉取开发镜像","link":"#拉取开发镜像","children":[]},{"level":2,"title":"创建并运行容器","slug":"创建并运行容器","link":"#创建并运行容器","children":[]},{"level":2,"title":"编译测试选项说明","slug":"编译测试选项说明","link":"#编译测试选项说明","children":[]},{"level":2,"title":"PolarDB-PG 各形态编译部署","slug":"polardb-pg-各形态编译部署","link":"#polardb-pg-各形态编译部署","children":[{"level":3,"title":"本地单节点实例","slug":"本地单节点实例","link":"#本地单节点实例","children":[]},{"level":3,"title":"本地多节点实例","slug":"本地多节点实例","link":"#本地多节点实例","children":[]},{"level":3,"title":"本地多节点带备库实例","slug":"本地多节点带备库实例","link":"#本地多节点带备库实例","children":[]},{"level":3,"title":"本地多节点 HTAP 实例","slug":"本地多节点-htap-实例","link":"#本地多节点-htap-实例","children":[]}]},{"level":2,"title":"实例回归测试","slug":"实例回归测试","link":"#实例回归测试","children":[]}],"git":{"updatedTime":1725527283000},"filePathRelative":"zh/development/dev-on-docker.md"}');export{K as comp,U as data};
